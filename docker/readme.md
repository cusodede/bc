# Докеризация проекта

## Краткое описание
Перед запуском сборки контейнеров, необходимо скопировать .env.example в .env, откорректировав параметры, если необходимо.
В файле .env определяются переменные окружения, часть которых необходимо для конфигурации docker-compose, а часть для проброса внутрь контейнеров.
После можно приступать к сборке контейнеров. Если сборка прошла успешно, то следующим действием нужно установить зависимости и выполнить миграции.
Это можно сделать либо в ручном режиме, либо в автоматическом.
В первом случае нужно выполнить команду для входа внутрь контейнера с приложением.
Во втором случае нужно выполнить команду из Makefile `make setup`, либо `composer setup` если выполняется сборка из под системы windows.
Если сборка не прошла, то для понимания причины прерывания процесса, можно проанализировать логи докер контейнера.
Для корректной работы Xdebug внутри Docker-контейнера создается общая сеть для бандла в docker-compose 192.168.220.0/28.
Это сделано для того, чтоб каждому члену команды не приходилось бы менять IP-адрес на свой в общем файле конфигурации бандла.
Перед запуском сборки нужно убедиться в том, что в php.ini включены нужные настройки под ОС.
Для систем MacOS или Windows, в параметре `xdebug.client_host` должно быть значение `host.docker.internal`.
Для UNIX систем в этом параметре нужно установить адрес 192.168.220.1.

## Команды для UNIX подобных систем

### Сборка контейнеров
~~~
make build
~~~
### Вход в контейнер
~~~
make exec s=<название контейнера>
~~~
### Запуск скрипта для установки зависимостей и выполнения миграций
~~~
make setup
~~~
### Проверить запущенные контейнеры
~~~
docker ps
~~~
### Посмотреть установленные образы
~~~
docker images
~~~
### Посмотреть логи контейнера
~~~
docker logs <имя контейнера>
~~~

## Команды для Windows систем

### Сборка контейнеров
~~~
composer build
~~~
### Запуск контейнеров
~~~
composer up
~~~
### Остановка контейнеров
~~~
composer stop
~~~
### Перезапуск контейнеров
~~~
composer restart
~~~
### Вход в контейнер
~~~
composer exec s=<название контейнера>
~~~
### Запуск скрипта для установки зависимостей и выполнения миграций
~~~
composer setup
~~~